import os
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils import executor

API_TOKEN = os.getenv("BOT_TOKEN") or "YOUR_TOKEN_HERE"  # –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 14 –≤–æ–ø—Ä–æ—Å–æ–≤
questions = [
    {
        "text": "–¢—ã —Å–∫–æ—Ä–µ–µ...",
        "options": [
            {"emoji": "üîß", "text": "–õ—é–±–ª—é –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –∏ —á–∏–Ω–∏—Ç—å", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üí¨", "text": "–û–±—â–∞—é—Å—å —Å –ª—é–¥—å–º–∏ –∏ —Ä—É–∫–æ–≤–æ–∂—É", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üé≠", "text": "–ú–µ—á—Ç–∞—é –∏ —Å–æ–∑–¥–∞—é –∏—Å–∫—É—Å—Å—Ç–≤–æ", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üí™", "text": "–†–∞–±–æ—Ç–∞—é —Ä—É–∫–∞–º–∏, –º–Ω–µ –Ω–µ —Å—Ç—Ä–∞—à–µ–Ω —Ç—Ä—É–¥", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–ß—Ç–æ –±—ã —Ç—ã –≤–∑—è–ª(–∞) —Å —Å–æ–±–æ–π –≤ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫—É –≤ 1965?",
        "options": [
            {"emoji": "üìï", "text": "–ó–∞–ø–∏—Å–Ω—É—é –∫–Ω–∏–∂–∫—É –∏ –ø–µ—Ä–æ", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üì∑", "text": "–ü–ª—ë–Ω–∫—É, —á—Ç–æ–±—ã —Å–Ω–∏–º–∞—Ç—å —Ö—Ä–æ–Ω–∏–∫—É", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üî¨", "text": "–ú–∏–Ω–∏-–º–∏–∫—Ä–æ—Å–∫–æ–ø ‚Äî –º–∞–ª–æ –ª–∏", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "ü•æ", "text": "–ö–∏—Ä–∑–æ–≤—ã–µ —Å–∞–ø–æ–≥–∏, –≤–¥—Ä—É–≥ —Å—Ç—Ä–æ–π–∫–∞", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–í—ã–±–µ—Ä–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ:",
        "options": [
            {"emoji": "üè≠", "text": "–ó–∞–≤–æ–¥ —Å –≥—É–ª–æ–º —Å—Ç–∞–Ω–∫–æ–≤", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üìö", "text": "–ö–∞–±–∏–Ω–µ—Ç —Å –∫–Ω–∏–≥–∞–º–∏ –∏ –±—É–º–∞–≥–∞–º–∏", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üé¨", "text": "–°—ä—ë–º–æ—á–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –∏–ª–∏ —Å—Ü–µ–Ω–∞", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "‚úàÔ∏è", "text": "–ö–∞–±–∏–Ω–∞ –ø–∏–ª–æ—Ç–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–Ω—ã–π –ø—É–Ω–∫—Ç", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"}
        ]
    },
    {
        "text": "–¢—ã –ø–æ–ª—É—á–∏–ª(–∞) —Å—Ä–æ—á–Ω—É—é —Ç–µ–ª–µ–≥—Ä–∞–º–º—É –∏–∑ –¶–ö. –¢–≤–æ—è —Ä–µ–∞–∫—Ü–∏—è?",
        "options": [
            {"emoji": "üì¨", "text": "–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–æ–∫–ª–∞–¥—ã–≤–∞—é –Ω–∞—á–∞–ª—å—Å—Ç–≤—É ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–æ", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üß™", "text": "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ, –≤–¥—Ä—É–≥ —ç—Ç–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "‚úçÔ∏è", "text": "–ü—Ä–µ–≤—Ä–∞—â–∞—é –≤ —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –∑–≤—É—á–∏—Ç –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω–æ", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "ü§∑‚Äç‚ôÇÔ∏è", "text": "–°–Ω–∞—á–∞–ª–∞ –¥–æ–¥–µ–ª–∞—é —Å–º–µ–Ω—É, –ø–æ—Ç–æ–º –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–ù–∞ —É–ª–∏—Ü—É –≤—ã–±—Ä–æ—Å–∏–ª–∏ —Ä–µ–¥–∫–∏–π —Ç—Ä–æ—Ñ–µ–π–Ω—ã–π –º–∞–≥–Ω–∏—Ç–æ—Ñ–æ–Ω 1950-—Ö. –ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å?",
        "options": [
            {"emoji": "üîß", "text": "–ü–æ—á–∏–Ω—é! –≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∞—è –Ω–∞—Ö–æ–¥–∫–∞", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üé§", "text": "–ò—Å–ø–æ–ª—å–∑—É—é –∫–∞–∫ —Ä–µ–∫–≤–∏–∑–∏—Ç –≤ –ø—å–µ—Å–µ", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üìª", "text": "–û—Ç–¥–∞–º –Ω–∞ –∑–∞–≤–æ–¥, –ø—É—Å—Ç—å –ø—É—Å–∫–∞—é—Ç –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üìö", "text": "–ü–æ–∏—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω—ë–º ‚Äî –º–æ–∂–µ—Ç, –æ–Ω —à–ø–∏–æ–Ω—Å–∫–∏–π", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"}
        ]
    },
    {
        "text": "–¢–µ–±–µ –¥–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: —Å–ª–∞–π–¥–æ—Å–∫–æ–ø. –ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å?",
        "options": [
            {"emoji": "üîç", "text": "–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–±–æ—Ä ‚Äî –º–æ–∂–Ω–æ –∏–∑—É—á–∞—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª—ã", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üì∏", "text": "–ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –¥–æ–º–∞—à–Ω–µ–π –ª–µ–∫—Ü–∏–∏", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üñº", "text": "–ü—Ä–µ–≤—Ä–∞—â—É –≤ —á–∞—Å—Ç—å —Å—Ü–µ–Ω–æ–≥—Ä–∞—Ñ–∏–∏", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "‚ùì", "text": "–ù–µ –∑–Ω–∞—é, —á—Ç–æ —ç—Ç–æ, –Ω–æ –∫—Ä—É—á—É –∏ –≤–µ—Ä—á—É", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–¢–µ–±–µ –¥–∞—é—Ç –≤—ã–±–æ—Ä –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏. –ö—É–¥–∞ –ø–æ–µ–¥–µ—à—å?",
        "options": [
            {"emoji": "üöÇ", "text": "–ù–∞ –ë–∞–π–∫–∞–ª–æ-–ê–º—É—Ä—Å–∫—É—é –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üé≠", "text": "–í –î–æ–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –≤ –ü–µ—Ä–µ–¥–µ–ª–∫–∏–Ω–æ", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üß™", "text": "–í –∑–∞–∫—Ä—ã—Ç—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üß±", "text": "–ù–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–∞ –ø–æ—Å–ª–µ –≤–æ–π–Ω—ã", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"}
        ]
    },
    {
        "text": "–¢—ã –æ–∫–∞–∑–∞–ª—Å—è(–ª–∞—Å—å) –≤ 1943. –ß—Ç–æ –¥–µ–ª–∞–µ—à—å?",
        "options": [
            {"emoji": "‚öîÔ∏è", "text": "–ò–¥—É –Ω–∞ —Ñ—Ä–æ–Ω—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–µ–º", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üî¨", "text": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–µ—Ö–Ω–∏–∫–∏", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üì£", "text": "–ü–æ–¥–Ω–∏–º–∞—é –º–æ—Ä–∞–ª—å –¥—É—Ö–∞ –Ω–∞—Ä–æ–¥–∞", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üöë", "text": "–†–∞–±–æ—Ç–∞—é –≤ –º–µ–¥—Å–∞–Ω–±–∞—Ç–µ", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"}
        ]
    },
    {
        "text": "–ß—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç–µ?",
        "options": [
            {"emoji": "üêå", "text": "–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –±—é—Ä–æ–∫—Ä–∞—Ç–∏—è", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üì¢", "text": "–ö–æ–≥–¥–∞ –Ω–∏–∫—Ç–æ –Ω–µ —Å–ª—É—à–∞–µ—Ç", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üìâ", "text": "–ö–æ–≥–¥–∞ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—à—å", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üö´", "text": "–ö–æ–≥–¥–∞ –Ω–µ –¥–∞—é—Ç –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å —Ä—É–∫–∞–º–∏", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"}
        ]
    },
    {
        "text": "–¢–≤–æ–π –≥–ª–∞–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?",
        "options": [
            {"emoji": "‚úèÔ∏è", "text": "–ö–∞—Ä–∞–Ω–¥–∞—à –∏ –±–ª–æ–∫–Ω–æ—Ç", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üîß", "text": "–ì–∞–µ—á–Ω—ã–π –∫–ª—é—á", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üì¢", "text": "–ú–∏–∫—Ä–æ—Ñ–æ–Ω", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üë©‚Äçüî¨", "text": "–ü—Ä–æ–±–∏—Ä–∫–∞", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–ß—Ç–æ –±—ã —Ç—ã –ø–æ–≤–µ—Å–∏–ª(–∞) —É —Å–µ–±—è –Ω–∞ —Å—Ç–µ–Ω–µ?",
        "options": [
            {"emoji": "üèÖ", "text": "–ü–ª–∞–∫–∞—Ç —Å –≥–µ—Ä–æ—è–º–∏ —Ç—Ä—É–¥–∞", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üé≠", "text": "–ê—Ñ–∏—à—É —Å–ø–µ–∫—Ç–∞–∫–ª—è", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üß¨", "text": "–°—Ö–µ–º—É —Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–ª–µ–∫—É–ª—ã", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üìú", "text": "–¶–∏—Ç–∞—Ç—É –õ–µ–Ω–∏–Ω–∞ –∏–ª–∏ –ì–∞–≥–∞—Ä–∏–Ω–∞", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"}
        ]
    },
    {
        "text": "–ö–æ–≥–¥–∞ —Ç—ã —Å–ª—ã—à–∏—à—å —Å–ª–æ–≤–æ ¬´–±—É–¥—É—â–µ–µ¬ª, —Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å...",
        "options": [
            {"emoji": "üöÄ", "text": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ—Å–º–æ—Å", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üìñ", "text": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üéº", "text": "–ò—Å–∫—É—Å—Å—Ç–≤–æ –∏ —Å–≤–æ–±–æ–¥—É", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üî®", "text": "–ú–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –∏ –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–æ–µ–∫", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    }
]

# –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: q_index –∏ answers
user_state = {}

def get_keyboard(options):
    kb = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    for opt in options:
        kb.add(KeyboardButton(f"{opt['emoji']} {opt['text']}"))
    return kb

@dp.message_handler(commands=['start'])
async def cmd_start(message: types.Message):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
    user_state[message.chat.id] = {'q': 0, 'answers': []}
    await message.answer("–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ ¬´–ü–ª—ë–Ω–∫–∞ —Å—É–¥—å–±—ã¬ª
–¢–µ—Å—Ç –∏–∑ 14 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞–∂–µ—Ç, –∫–µ–º –±—ã —Ç—ã –±—ã–ª(–∞) –≤ XX –≤–µ–∫–µ.")
    await asyncio.sleep(1.5)
    q0 = questions[0]
    await message.answer(f"–í–æ–ø—Ä–æ—Å 1 –∏–∑ {len(questions)}:
{q0['text']}", reply_markup=get_keyboard(q0['options']))

@dp.message_handler(lambda message: message.chat.id in user_state)
async def process_answer(message: types.Message):
    state = user_state[message.chat.id]
    idx = state['q']
    # –ù–∞–π–¥—ë–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π opt.value
    selected = None
    for opt in questions[idx]['options']:
        if message.text.startswith(opt['emoji']):
            selected = opt['value']
            break
    if selected:
        state['answers'].append(selected)
    idx += 1
    if idx < len(questions):
        state['q'] = idx
        q = questions[idx]
        await message.answer(f"–í–æ–ø—Ä–æ—Å {idx+1} –∏–∑ {len(questions)}:
{q['text']}", reply_markup=get_keyboard(q['options']))
    else:
        # –ü–æ–¥—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        counts = {}
        for v in state['answers']:
            counts[v] = counts.get(v, 0) + 1
        result_key = max(counts, key=counts.get)
        titles = {
            "—Ç–µ—Ö–Ω–∞—Ä—å": "–¢–µ—Ö–Ω–∞—Ä—å",
            "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å",
            "—Ç–≤–æ—Ä–µ—Ü": "–¢–≤–æ—Ä–µ—Ü",
            "—Ä–∞–±–æ—á–∏–π": "–†–∞–±–æ—á–∏–π"
        }
        await message.answer(f"üìù –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {titles.get(result_key, result_key)}", reply_markup=types.ReplyKeyboardRemove())
        user_state.pop(message.chat.id)

if __name__ == "__main__":
    executor.start_polling(dp)
