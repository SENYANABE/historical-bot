
import os
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils import executor
from collections import Counter

API_TOKEN = os.getenv("BOT_TOKEN")

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

questions = [
    {
        "text": "–¢—ã —Å–∫–æ—Ä–µ–µ...",
        "options": [
            {"emoji": "üîß", "text": "–õ—é–±–ª—é –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –∏ —á–∏–Ω–∏—Ç—å", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üí¨", "text": "–û–±—â–∞—é—Å—å —Å –ª—é–¥—å–º–∏ –∏ —Ä—É–∫–æ–≤–æ–∂—É", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üé≠", "text": "–ú–µ—á—Ç–∞—é –∏ —Å–æ–∑–¥–∞—é –∏—Å–∫—É—Å—Å—Ç–≤–æ", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üí™", "text": "–†–∞–±–æ—Ç–∞—é —Ä—É–∫–∞–º–∏, –º–Ω–µ –Ω–µ —Å—Ç—Ä–∞—à–µ–Ω —Ç—Ä—É–¥", "value": "—Ä–∞–±–æ—á–∏–π"}
        ,
    {"text": "–ß—Ç–æ –±—ã —Ç—ã –≤–∑—è–ª(–∞) —Å —Å–æ–±–æ–π –≤ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫—É –≤ 1965?", "options": ['üìï –ó–∞–ø–∏—Å–Ω—É—é –∫–Ω–∏–∂–∫—É –∏ –ø–µ—Ä–æ', 'üì∑ –ü–ª—ë–Ω–∫—É, —á—Ç–æ–±—ã —Å–Ω–∏–º–∞—Ç—å —Ö—Ä–æ–Ω–∏–∫—É', 'üî¨ –ú–∏–Ω–∏-–º–∏–∫—Ä–æ—Å–∫–æ–ø ‚Äî –º–∞–ª–æ –ª–∏', 'ü•æ –ö–∏—Ä–∑–æ–≤—ã–µ —Å–∞–ø–æ–≥–∏, –≤–¥—Ä—É–≥ —Å—Ç—Ä–æ–π–∫–∞']},
    {"text": "–í—ã–±–µ—Ä–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ:", "options": ['üè≠ –ó–∞–≤–æ–¥ —Å –≥—É–ª–æ–º —Å—Ç–∞–Ω–∫–æ–≤', 'üìö –ö–∞–±–∏–Ω–µ—Ç —Å –∫–Ω–∏–≥–∞–º–∏ –∏ –±—É–º–∞–≥–∞–º–∏', 'üé¨ –°—ä—ë–º–æ—á–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –∏–ª–∏ —Å—Ü–µ–Ω–∞', '‚úàÔ∏è –ö–∞–±–∏–Ω–∞ –ø–∏–ª–æ—Ç–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–Ω—ã–π –ø—É–Ω–∫—Ç']},
    {"text": "–¢—ã –ø–æ–ª—É—á–∏–ª(–∞) —Å—Ä–æ—á–Ω—É—é —Ç–µ–ª–µ–≥—Ä–∞–º–º—É –∏–∑ –¶–ö. –¢–≤–æ—è —Ä–µ–∞–∫—Ü–∏—è?", "options": ['üì¨ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–æ–∫–ª–∞–¥—ã–≤–∞—é –Ω–∞—á–∞–ª—å—Å—Ç–≤—É ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–æ', 'üß™ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ, –≤–¥—Ä—É–≥ —ç—Ç–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç', '‚úçÔ∏è –ü—Ä–µ–≤—Ä–∞—â–∞—é –≤ —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –∑–≤—É—á–∏—Ç –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω–æ', 'ü§∑\u200d‚ôÇÔ∏è –°–Ω–∞—á–∞–ª–∞ –¥–æ–¥–µ–ª–∞—é —Å–º–µ–Ω—É, –ø–æ—Ç–æ–º –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ']},
    {"text": "–ù–∞ —É–ª–∏—Ü—É –≤—ã–±—Ä–æ—Å–∏–ª–∏ —Ä–µ–¥–∫–∏–π —Ç—Ä–æ—Ñ–µ–π–Ω—ã–π –º–∞–≥–Ω–∏—Ç–æ—Ñ–æ–Ω 1950-—Ö. –ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å?", "options": ['üîß –ü–æ—á–∏–Ω—é! –≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∞—è –Ω–∞—Ö–æ–¥–∫–∞', 'üé§ –ò—Å–ø–æ–ª—å–∑—É—é –∫–∞–∫ —Ä–µ–∫–≤–∏–∑–∏—Ç –≤ –ø—å–µ—Å–µ', 'üìª –û—Ç–¥–∞–º –Ω–∞ –∑–∞–≤–æ–¥, –ø—É—Å—Ç—å –ø—É—Å–∫–∞—é—Ç –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', 'üìö –ü–æ–∏—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω—ë–º ‚Äî –º–æ–∂–µ—Ç, –æ–Ω —à–ø–∏–æ–Ω—Å–∫–∏–π']},
    {"text": "–¢–µ–±–µ –¥–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: —Å–ª–∞–π–¥–æ—Å–∫–æ–ø. –ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å?", "options": ['üîç –û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–±–æ—Ä ‚Äî –º–æ–∂–Ω–æ –∏–∑—É—á–∞—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª—ã', 'üì∏ –ò—Å–ø–æ–ª—å–∑—É—é –¥–ª—è –¥–æ–º–∞—à–Ω–µ–π –ª–µ–∫—Ü–∏–∏', 'üñº –ü—Ä–µ–≤—Ä–∞—â—É –≤ —á–∞—Å—Ç—å —Å—Ü–µ–Ω–æ–≥—Ä–∞—Ñ–∏–∏', '‚ùì –ù–µ –∑–Ω–∞—é, —á—Ç–æ —ç—Ç–æ, –Ω–æ –∫—Ä—É—á—É –∏ –≤–µ—Ä—á—É']},
    {"text": "–¢–µ–±–µ –¥–∞—é—Ç –≤—ã–±–æ—Ä –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏. –ö—É–¥–∞ –ø–æ–µ–¥–µ—à—å?", "options": ['üöÇ –ù–∞ –ë–∞–π–∫–∞–ª–æ-–ê–º—É—Ä—Å–∫—É—é –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å', 'üé≠ –í –î–æ–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –≤ –ü–µ—Ä–µ–¥–µ–ª–∫–∏–Ω–æ', 'üß™ –í –∑–∞–∫—Ä—ã—Ç—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é', 'üß± –ù–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–∞ –ø–æ—Å–ª–µ –≤–æ–π–Ω—ã']},
    {"text": "–¢—ã –æ–∫–∞–∑–∞–ª—Å—è(–ª–∞—Å—å) –≤ 1943. –ß—Ç–æ –¥–µ–ª–∞–µ—à—å?", "options": ['‚öîÔ∏è –ò–¥—É –Ω–∞ —Ñ—Ä–æ–Ω—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–µ–º', 'üî¨ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–µ—Ö–Ω–∏–∫–∏', 'üì£ –ü–æ–¥–Ω–∏–º–∞—é –º–æ—Ä–∞–ª—å –¥—É—Ö–∞ –Ω–∞—Ä–æ–¥–∞', 'üöë –†–∞–±–æ—Ç–∞—é –≤ –º–µ–¥—Å–∞–Ω–±–∞—Ç–µ']},
    {"text": "–ß—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç–µ?", "options": ['üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –±—é—Ä–æ–∫—Ä–∞—Ç–∏—è', 'üì¢ –ö–æ–≥–¥–∞ –Ω–∏–∫—Ç–æ –Ω–µ —Å–ª—É—à–∞–µ—Ç', 'üìâ –ö–æ–≥–¥–∞ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—à—å', 'üö´ –ö–æ–≥–¥–∞ –Ω–µ –¥–∞—é—Ç –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å —Ä—É–∫–∞–º–∏']},
    {"text": "–¢–≤–æ–π –≥–ª–∞–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?", "options": ['‚úèÔ∏è –ö–∞—Ä–∞–Ω–¥–∞—à –∏ –±–ª–æ–∫–Ω–æ—Ç', 'üîß –ì–∞–µ—á–Ω—ã–π –∫–ª—é—á', 'üì¢ –ú–∏–∫—Ä–æ—Ñ–æ–Ω', 'üë©\u200düî¨ –ü—Ä–æ–±–∏—Ä–∫–∞']},
    {"text": "–ß—Ç–æ –±—ã —Ç—ã –ø–æ–≤–µ—Å–∏–ª(–∞) —É —Å–µ–±—è –Ω–∞ —Å—Ç–µ–Ω–µ?", "options": ['üèÖ –ü–ª–∞–∫–∞—Ç —Å –≥–µ—Ä–æ—è–º–∏ —Ç—Ä—É–¥–∞', 'üé≠ –ê—Ñ–∏—à—É —Å–ø–µ–∫—Ç–∞–∫–ª—è', 'üß¨ –°—Ö–µ–º—É —Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–ª–µ–∫—É–ª—ã', 'üìú –¶–∏—Ç–∞—Ç—É –õ–µ–Ω–∏–Ω–∞ –∏–ª–∏ –ì–∞–≥–∞—Ä–∏–Ω–∞']},
    {"text": "–ö–æ–≥–¥–∞ —Ç—ã —Å–ª—ã—à–∏—à—å —Å–ª–æ–≤–æ ¬´–±—É–¥—É—â–µ–µ¬ª, —Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å...", "options": ['üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ—Å–º–æ—Å', 'üìñ –û–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π', 'üéº –ò—Å–∫—É—Å—Å—Ç–≤–æ –∏ —Å–≤–æ–±–æ–¥—É', 'üî® –ú–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –∏ –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–æ–µ–∫']}]
    },
    {
        "text": "–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ —Ä–∏—Å–∫—É?",
        "options": [
            {"emoji": "üòå", "text": "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üí•", "text": "–õ—é–±–ª—é, –∫–æ–≥–¥–∞ –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω –∫–∏–ø–∏—Ç", "value": "—Ä–∞–±–æ—á–∏–π"},
            {"emoji": "üß†", "text": "–ì–ª–∞–≤–Ω–æ–µ ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å, —Ä–∏—Å–∫ –ø—É—Å—Ç—å –±—É–¥–µ—Ç", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üöú", "text": "–ú–Ω–µ –≤—Å—ë —Ä–∞–≤–Ω–æ, —Ä–∞–±–æ—Ç–∞ ‚Äî —ç—Ç–æ –¥–µ–ª–æ", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    },
    {
        "text": "–ö–∞–∫–∞—è —Å—Ü–µ–Ω–∞ —Ç–µ–±–µ –±–ª–∏–∂–µ?",
        "options": [
            {"emoji": "üé§", "text": "–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–æ–π", "value": "—Ç–≤–æ—Ä–µ—Ü"},
            {"emoji": "üß™", "text": "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞", "value": "—Ç–µ—Ö–Ω–∞—Ä—å"},
            {"emoji": "üëÆ", "text": "–ó–∞—è–≤–ª–µ–Ω–∏–µ –≤ –¥—É—Ö–µ '–ø–æ—Ä—è–¥–æ–∫ –±—É–¥–µ—Ç!'", "value": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"},
            {"emoji": "üë∑", "text": "–†–∞–±–æ—Ç–∞ –≤ —Ü–µ—Ö—É —É —Å—Ç–∞–Ω–∫–∞", "value": "—Ä–∞–±–æ—á–∏–π"}
        ]
    }
    # ... –û—Å—Ç–∞–ª—å–Ω—ã–µ 11 –≤–æ–ø—Ä–æ—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
]

# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

user_answers = {}

@dp.message_handler(commands=["start"])
async def start_handler(message: types.Message):
    user_id = message.from_user.id
    user_answers[user_id] = {"step": 0, "answers": []}
    await send_question(message.chat.id, user_id)

async def send_question(chat_id, user_id):
    step = user_answers[user_id]["step"]
    if step >= len(questions):
        await send_result(chat_id, user_id)
        return

    question = questions[step]
    keyboard = ReplyKeyboardMarkup(resize_keyboard=True)
    for option in question["options"]:
        keyboard.add(KeyboardButton(f"{option['emoji']} {option['text']}"))

    await bot.send_message(chat_id, f"*–í–æ–ø—Ä–æ—Å {step+1}:*\n{question['text']}", parse_mode="Markdown", reply_markup=keyboard)

@dp.message_handler()
async def answer_handler(message: types.Message):
    user_id = message.from_user.id
    if user_id not in user_answers:
        return

    step = user_answers[user_id]["step"]
    if step >= len(questions):
        return

    options = questions[step]["options"]
    selected = None
    for option in options:
        if option["text"] in message.text:
            selected = option["value"]
            break

    if selected:
        user_answers[user_id]["answers"].append(selected)
        user_answers[user_id]["step"] += 1
        await send_question(message.chat.id, user_id)

async def send_result(chat_id, user_id):
    counts = Counter(user_answers[user_id]["answers"])
    top_prof = counts.most_common(1)[0][0]

    history = {
        "—Ç–µ—Ö–Ω–∞—Ä—å": "–ò–Ω–∂–µ–Ω–µ—Ä: –∫–ª—é—á–µ–≤–∞—è —Ñ–∏–≥—É—Ä–∞ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –°—Ç—Ä–æ–∏–ª –±—É–¥—É—â–µ–µ —Å—Ç—Ä–∞–Ω—ã.",
        "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å": "–ü–∞—Ä—Ç–∏–π–Ω—ã–π –¥–µ—è—Ç–µ–ª—å: —É–ø—Ä–∞–≤–ª—è–ª –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª –º–∞—Å—Å—ã.",
        "—Ç–≤–æ—Ä–µ—Ü": "–•—É–¥–æ–∂–Ω–∏–∫ –∏–ª–∏ –∞–∫—Ç—ë—Ä: —Å–æ–∑–¥–∞–≤–∞–ª —Å–º—ã—Å–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç —ç–ø–æ—Ö—É.",
        "—Ä–∞–±–æ—á–∏–π": "–†–∞–±–æ—á–∏–π: –≥–µ—Ä–æ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –¥–≤–∏–≥–∞–ª —Å—Ç—Ä–æ–π–∫–∏ –≤–µ–∫–∞ –∏ –∑–∞–≤–æ–¥—ã."
    }

    famous = {
        "—Ç–µ—Ö–Ω–∞—Ä—å": "–°–µ—Ä–≥–µ–π –ö–æ—Ä–æ–ª—ë–≤, –ê–Ω–¥—Ä–µ–π –¢—É–ø–æ–ª–µ–≤",
        "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å": "–Æ—Ä–∏–π –ê–Ω–¥—Ä–æ–ø–æ–≤, –õ–∞–≤—Ä–µ–Ω—Ç–∏–π –ë–µ—Ä–∏—è",
        "—Ç–≤–æ—Ä–µ—Ü": "–ê–Ω–¥—Ä–µ–π –¢–∞—Ä–∫–æ–≤—Å–∫–∏–π, –ú–∞–π—è –ü–ª–∏—Å–µ—Ü–∫–∞—è",
        "—Ä–∞–±–æ—á–∏–π": "–ê–ª–µ–∫—Å–µ–π –°—Ç–∞—Ö–∞–Ω–æ–≤, –ü—ë—Ç—Ä –ö—Ä–∏–≤–æ–Ω–æ–≥–æ–≤"
    }

    text = f"üîé –¢—ã ‚Äî {top_prof.title()}!\n\n"            f"üìú {history.get(top_prof, '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è XX –≤–µ–∫–∞!')}\n"            f"üéñ –ó–Ω–∞–º–µ–Ω–∏—Ç—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏: {famous.get(top_prof, '‚Äî')}"

    await bot.send_message(chat_id, text, reply_markup=types.ReplyKeyboardRemove())
    user_answers.pop(user_id, None)

if __name__ == "__main__":
    from aiogram import executor
    executor.start_polling(dp)
